// Copyright 2011 David Galles, University of San Francisco. All rights reserved.
//
// Redistribution and use in source and binary forms, with or without modification, are
// permitted provided that the following conditions are met:
//
// 1. Redistributions of source code must retain the above copyright notice, this list of
// conditions and the following disclaimer.
//
// 2. Redistributions in binary form must reproduce the above copyright notice, this list
// of conditions and the following disclaimer in the documentation and/or other materials
// provided with the distribution.
//
// THIS SOFTWARE IS PROVIDED BY <COPYRIGHT HOLDER> ``AS IS'' AND ANY EXPRESS OR IMPLIED
// WARRANTIES, INCLUDING, BUT NOT LIMITED TO, THE IMPLIED WARRANTIES OF MERCHANTABILITY AND
// FITNESS FOR A PARTICULAR PURPOSE ARE DISCLAIMED. IN NO EVENT SHALL <COPYRIGHT HOLDER> OR
// CONTRIBUTORS BE LIABLE FOR ANY DIRECT, INDIRECT, INCIDENTAL, SPECIAL, EXEMPLARY, OR
// CONSEQUENTIAL DAMAGES (INCLUDING, BUT NOT LIMITED TO, PROCUREMENT OF SUBSTITUTE GOODS OR
// SERVICES; LOSS OF USE, DATA, OR PROFITS; OR BUSINESS INTERRUPTION) HOWEVER CAUSED AND ON
// ANY THEORY OF LIABILITY, WHETHER IN CONTRACT, STRICT LIABILITY, OR TORT (INCLUDING
// NEGLIGENCE OR OTHERWISE) ARISING IN ANY WAY OUT OF THE USE OF THIS SOFTWARE, EVEN IF
// ADVISED OF THE POSSIBILITY OF SUCH DAMAGE.
//
// The views and conclusions contained in the software and documentation are those of the
// authors and should not be interpreted as representing official policies, either expressed
// or implied, of the University of San Francisco

function ComparisonSort(e,t,n){this.init(e,t,n)}function init(){var e=initCanvas();currentAlg=new ComparisonSort(e,canvas.width,canvas.height)}var ARRAY_SIZE_SMALL=22;var ARRAY_WIDTH_SMALL=17;var ARRAY_BAR_WIDTH_SMALL=10;var ARRAY_INITIAL_X_SMALL=15;var ARRAY_Y_POS=250;var ARRAY_LABEL_Y_POS=260;var LOWER_ARRAY_Y_POS=400;var LOWER_ARRAY_LABEL_Y_POS=410;var SCALE_FACTOR=2;var ARRAY_SIZE_LARGE=200;var ARRAY_WIDTH_LARGE=4;var ARRAY_BAR_WIDTH_LARGE=2;var ARRAY_INITIAL_X_LARGE=15;var BAR_FOREGROUND_COLOR="#0000FF";var BAR_BACKGROUND_COLOR="#AAAAFF";var INDEX_COLOR="#0000FF";var HIGHLIGHT_BAR_COLOR="#FF0000";var HIGHLIGHT_BAR_BACKGROUND_COLOR="#FFAAAA";var QUICKSORT_LINE_COLOR="#FF0000";ComparisonSort.prototype=new Algorithm;ComparisonSort.prototype.constructor=ComparisonSort;ComparisonSort.superclass=Algorithm.prototype;ComparisonSort.prototype.init=function(e,t,n){var r=ComparisonSort.superclass;var i=r.init;i.call(this,e);this.addControls();this.nextIndex=0;this.setArraySize(true);this.arrayData=new Array(ARRAY_SIZE_LARGE);this.arraySwap=new Array(ARRAY_SIZE_LARGE);this.labelsSwap=new Array(ARRAY_SIZE_LARGE);this.objectsSwap=new Array(ARRAY_SIZE_LARGE);this.createVisualObjects()};ComparisonSort.prototype.addControls=function(){this.resetButton=addControlToAlgorithmBar("Button","Preme\u0161aj podatke");this.resetButton.onclick=this.resetCallback.bind(this);this.mergeSortButton=addControlToAlgorithmBar("Button","Izvedi urejanje z zlivanjem");this.mergeSortButton.onclick=this.mergeSortCallback.bind(this)};ComparisonSort.prototype.setArraySize=function(e){if(e){this.array_size=ARRAY_SIZE_SMALL;this.array_width=ARRAY_WIDTH_SMALL;this.array_bar_width=ARRAY_BAR_WIDTH_SMALL;this.array_initial_x=ARRAY_INITIAL_X_SMALL;this.array_y_pos=ARRAY_Y_POS;this.array_label_y_pos=ARRAY_LABEL_Y_POS;this.showLabels=true}else{this.array_size=ARRAY_SIZE_LARGE;this.array_width=ARRAY_WIDTH_LARGE;this.array_bar_width=ARRAY_BAR_WIDTH_LARGE;this.array_initial_x=ARRAY_INITIAL_X_LARGE;this.array_y_pos=ARRAY_Y_POS;this.array_label_y_pos=ARRAY_LABEL_Y_POS;this.showLabels=false}};ComparisonSort.prototype.resetAll=function(e){this.animationManager.resetAll();this.setArraySize(!e);this.nextIndex=0;this.createVisualObjects()};ComparisonSort.prototype.randomizeArray=function(){this.commands=new Array;for(var e=0;e<this.array_size;e++){this.arrayData[e]=Math.floor(1+Math.random()*99);this.oldData[e]=this.arrayData[e];if(this.showLabels){this.cmd("SetText",this.barLabels[e],this.arrayData[e])}else{this.cmd("SetText",this.barLabels[e],"")}this.cmd("SetHeight",this.barObjects[e],this.arrayData[e]*SCALE_FACTOR)}this.animationManager.StartNewAnimation(this.commands);this.animationManager.skipForward();this.animationManager.clearHistory()};ComparisonSort.prototype.swap=function(e,t){var n=this.arrayData[e];this.arrayData[e]=this.arrayData[t];this.arrayData[t]=n;n=this.barObjects[e];this.barObjects[e]=this.barObjects[t];this.barObjects[t]=n;n=this.barLabels[e];this.barLabels[e]=this.barLabels[t];this.barLabels[t]=n;this.cmd("Move",this.barObjects[e],this.barPositionsX[e],this.array_y_pos);this.cmd("Move",this.barObjects[t],this.barPositionsX[t],this.array_y_pos);this.cmd("Move",this.barLabels[e],this.barPositionsX[e],this.array_label_y_pos);this.cmd("Move",this.barLabels[t],this.barPositionsX[t],this.array_label_y_pos);this.cmd("Step")};ComparisonSort.prototype.createVisualObjects=function(){this.barObjects=new Array(this.array_size);this.oldBarObjects=new Array(this.array_size);this.oldbarLabels=new Array(this.array_size);this.barLabels=new Array(this.array_size);this.barPositionsX=new Array(this.array_size);this.oldData=new Array(this.array_size);this.obscureObject=new Array(this.array_size);var e=this.array_initial_x;var t=this.array_y_pos;var n=this.array_label_y_pos;this.commands=new Array;for(var r=0;r<this.array_size;r++){e=e+this.array_width;this.barPositionsX[r]=e;this.cmd("CreateRectangle",this.nextIndex,"",this.array_bar_width,200,e,t,"center","bottom");this.cmd("SetForegroundColor",this.nextIndex,BAR_FOREGROUND_COLOR);this.cmd("SetBackgroundColor",this.nextIndex,BAR_BACKGROUND_COLOR);this.barObjects[r]=this.nextIndex;this.oldBarObjects[r]=this.barObjects[r];this.nextIndex+=1;if(this.showLabels){this.cmd("CreateLabel",this.nextIndex,"99",e,n)}else{this.cmd("CreateLabel",this.nextIndex,"",e,n)}this.cmd("SetForegroundColor",this.nextIndex,INDEX_COLOR);this.barLabels[r]=this.nextIndex;this.oldbarLabels[r]=this.barLabels[r];++this.nextIndex}this.animationManager.StartNewAnimation(this.commands);this.animationManager.skipForward();this.randomizeArray();for(r=0;r<this.array_size;r++){this.obscureObject[r]=false}this.lastCreatedIndex=this.nextIndex};ComparisonSort.prototype.highlightRange=function(e,t){for(var n=0;n<e;n++){if(!this.obscureObject[n]){this.obscureObject[n]=true;this.cmd("SetAlpha",this.barObjects[n],.25);this.cmd("SetAlpha",this.barLabels[n],.25)}}for(n=e;n<=t;n++){if(this.obscureObject[n]){this.obscureObject[n]=false;this.cmd("SetAlpha",this.barObjects[n],1);this.cmd("SetAlpha",this.barLabels[n],1)}}for(n=t+1;n<this.array_size;n++){if(!this.obscureObject[n]){this.obscureObject[n]=true;this.cmd("SetAlpha",this.barObjects[n],.25);this.cmd("SetAlpha",this.barLabels[n],.25)}}};ComparisonSort.prototype.reset=function(){for(var e=0;e<this.array_size;e++){this.arrayData[e]=this.oldData[e];this.barObjects[e]=this.oldBarObjects[e];this.barLabels[e]=this.oldbarLabels[e];if(this.showLabels){this.cmd("SetText",this.barLabels[e],this.arrayData[e])}else{this.cmd("SetText",this.barLabels[e],"")}this.cmd("SetHeight",this.barObjects[e],this.arrayData[e]*SCALE_FACTOR)}this.commands=new Array};ComparisonSort.prototype.resetCallback=function(e){this.randomizeArray()};ComparisonSort.prototype.mergeSortCallback=function(e){this.animationManager.clearHistory();this.commands=new Array;this.doMergeSort(0,this.array_size-1);this.animationManager.StartNewAnimation(this.commands)};ComparisonSort.prototype.doMergeSort=function(e,t){this.highlightRange(e,t);if(e<t){this.cmd("Step");var n=Math.floor((e+t)/2);this.doMergeSort(e,n);this.doMergeSort(n+1,t);this.highlightRange(e,t);var r=e;var i=e;var s=n+1;while(r<=t){if(i<=n&&(s>t||this.arrayData[i]<=this.arrayData[s])){this.arraySwap[r]=this.arrayData[i];this.cmd("Move",this.barObjects[i],this.barPositionsX[r],LOWER_ARRAY_Y_POS);this.cmd("Move",this.barLabels[i],this.barPositionsX[r],LOWER_ARRAY_LABEL_Y_POS);this.cmd("Step");this.labelsSwap[r]=this.barLabels[i];this.objectsSwap[r]=this.barObjects[i];r++;i++}else{this.arraySwap[r]=this.arrayData[s];this.cmd("Move",this.barLabels[s],this.barPositionsX[r],LOWER_ARRAY_LABEL_Y_POS);this.cmd("Move",this.barObjects[s],this.barPositionsX[r],LOWER_ARRAY_Y_POS);this.cmd("Step");this.labelsSwap[r]=this.barLabels[s];this.objectsSwap[r]=this.barObjects[s];r++;s++}}for(r=e;r<=t;r++){this.barObjects[r]=this.objectsSwap[r];this.barLabels[r]=this.labelsSwap[r];this.arrayData[r]=this.arraySwap[r];this.cmd("Move",this.barObjects[r],this.barPositionsX[r],this.array_y_pos);this.cmd("Move",this.barLabels[r],this.barPositionsX[r],this.array_label_y_pos)}this.cmd("Step")}else{this.cmd("Step")}};ComparisonSort.prototype.disableUI=function(e){this.resetButton.disabled=true;this.mergeSortButton.disabled=true};ComparisonSort.prototype.enableUI=function(e){this.resetButton.disabled=false;this.mergeSortButton.disabled=false};var currentAlg