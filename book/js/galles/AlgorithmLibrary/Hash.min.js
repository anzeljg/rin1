// Copyright 2011 David Galles, University of San Francisco. All rights reserved.
//
// Redistribution and use in source and binary forms, with or without modification, are
// permitted provided that the following conditions are met:
//
// 1. Redistributions of source code must retain the above copyright notice, this list of
// conditions and the following disclaimer.
//
// 2. Redistributions in binary form must reproduce the above copyright notice, this list
// of conditions and the following disclaimer in the documentation and/or other materials
// provided with the distribution.
//
// THIS SOFTWARE IS PROVIDED BY <COPYRIGHT HOLDER> ``AS IS'' AND ANY EXPRESS OR IMPLIED
// WARRANTIES, INCLUDING, BUT NOT LIMITED TO, THE IMPLIED WARRANTIES OF MERCHANTABILITY AND
// FITNESS FOR A PARTICULAR PURPOSE ARE DISCLAIMED. IN NO EVENT SHALL <COPYRIGHT HOLDER> OR
// CONTRIBUTORS BE LIABLE FOR ANY DIRECT, INDIRECT, INCIDENTAL, SPECIAL, EXEMPLARY, OR
// CONSEQUENTIAL DAMAGES (INCLUDING, BUT NOT LIMITED TO, PROCUREMENT OF SUBSTITUTE GOODS OR
// SERVICES; LOSS OF USE, DATA, OR PROFITS; OR BUSINESS INTERRUPTION) HOWEVER CAUSED AND ON
// ANY THEORY OF LIABILITY, WHETHER IN CONTRACT, STRICT LIABILITY, OR TORT (INCLUDING
// NEGLIGENCE OR OTHERWISE) ARISING IN ANY WAY OUT OF THE USE OF THIS SOFTWARE, EVEN IF
// ADVISED OF THE POSSIBILITY OF SUCH DAMAGE.
//
// The views and conclusions contained in the software and documentation are those of the
// authors and should not be interpreted as representing official policies, either expressed
// or implied, of the University of San Francisco

function Hash(t,e,i){void 0!=t&&this.init(t,e,i)}Hash.prototype=new Algorithm,Hash.prototype.constructor=Hash,Hash.superclass=Algorithm.prototype;var MAX_HASH_LENGTH=10,HASH_NUMBER_START_X=200,HASH_X_DIFF=7,HASH_NUMBER_START_Y=10,HASH_ADD_START_Y=30,HASH_INPUT_START_X=60,HASH_INPUT_X_DIFF=7,HASH_INPUT_START_Y=45,HASH_ADD_LINE_Y=42,HASH_RESULT_Y=50,ELF_HASH_SHIFT=10,HASH_LABEL_X=300,HASH_LABEL_Y=30,HASH_LABEL_DELTA_X=50,HIGHLIGHT_COLOR="#0000FF";Hash.prototype.init=function(t,e,i){var s=Hash.superclass,h=s.init;h.call(this,t,e,i),this.addControls(),this.nextIndex=0,this.hashingIntegers=!0},Hash.prototype.addControls=function(){this.insertField=addControlToAlgorithmBar("Text",""),this.insertField.size=MAX_HASH_LENGTH,this.insertField.onkeydown=this.returnSubmit(this.insertField,this.insertCallback.bind(this),MAX_HASH_LENGTH,!0),this.insertButton=addControlToAlgorithmBar("Button","Dodaj"),this.insertButton.onclick=this.insertCallback.bind(this),this.deleteField=addControlToAlgorithmBar("Text",""),this.deleteField.size=MAX_HASH_LENGTH,this.deleteField.onkeydown=this.returnSubmit(this.insertField,this.deleteCallback.bind(this),MAX_HASH_LENGTH,!0),this.deleteButton=addControlToAlgorithmBar("Button","Odstrani"),this.deleteButton.onclick=this.deleteCallback.bind(this),this.findField=addControlToAlgorithmBar("Text",""),this.findField.size=MAX_HASH_LENGTH,this.findField.onkeydown=this.returnSubmit(this.insertField,this.findCallback.bind(this),MAX_HASH_LENGTH,!0),this.findButton=addControlToAlgorithmBar("Button","Najdi"),this.findButton.onclick=this.findCallback.bind(this);var t=addRadioButtonGroupToAlgorithmBar(["število","znakovni niz"],"HashType");this.hashIntegerButton=t[0],this.hashIntegerButton.onclick=this.changeHashTypeCallback.bind(this,!0),this.hashStringButton=t[1],this.hashStringButton.onclick=this.changeHashTypeCallback.bind(this,!1),this.hashIntegerButton.checked=!0},Hash.prototype.changeHashTypeCallback=function(t,e){this.hashingIntegers!=t&&this.implementAction(this.changeHashType.bind(this),t)},Hash.prototype.changeHashType=function(t){return this.hashingIntegers=t,this.hashingIntegers?(this.hashIntegerButton.checked=!0,this.insertField.onkeydown=this.returnSubmit(this.insertField,this.insertCallback.bind(this),MAX_HASH_LENGTH,!0),this.deleteField.onkeydown=this.returnSubmit(this.insertField,this.deleteCallback.bind(this),MAX_HASH_LENGTH,!0),this.findField.onkeydown=this.returnSubmit(this.insertField,this.findCallback.bind(this),MAX_HASH_LENGTH,!0)):(this.hashStringButton.checked=!0,this.insertField.onkeydown=this.returnSubmit(this.insertField,this.insertCallback.bind(this),MAX_HASH_LENGTH,!1),this.deleteField.onkeydown=this.returnSubmit(this.insertField,this.deleteCallback.bind(this),MAX_HASH_LENGTH,!1),this.findField.onkeydown=this.returnSubmit(this.insertField,this.findCallback.bind(this),MAX_HASH_LENGTH,!1)),this.resetAll()},Hash.prototype.doHash=function(t){if(this.hashingIntegers){var e=this.nextIndex++,i=this.nextIndex++,s=this.nextIndex++,h=parseInt(t)%this.table_size;return this.currHash=parseInt(t),this.cmd("CreateLabel",e,t+" % "+String(this.table_size)+" = ",HASH_LABEL_X,HASH_LABEL_Y),this.cmd("CreateLabel",i,h,HASH_LABEL_X+HASH_LABEL_DELTA_X,HASH_LABEL_Y),this.cmd("Step"),this.cmd("CreateHighlightCircle",s,HIGHLIGHT_COLOR,HASH_LABEL_X+HASH_LABEL_DELTA_X,HASH_LABEL_Y),this.cmd("Move",s,this.indexXPos[h],this.indexYPos[h]),this.cmd("Step"),this.cmd("Delete",e),this.cmd("Delete",i),this.cmd("Delete",s),this.nextIndex-=3,h}var n=(this.nextIndex,this.nextIndex++);this.cmd("CreateLabel",n,"Preslikava:",10,45,0);for(var H=new Array(t.length),d=new Array(t.length),_=0;_<t.length;_++)H[_]=this.nextIndex++,d[_]=t.charAt(_),this.cmd("CreateLabel",H[_],d[_],HASH_INPUT_START_X+_*HASH_INPUT_X_DIFF,HASH_INPUT_START_Y,0);var r=new Array(32),l=new Array(32),a=new Array(8),A=new Array(8),o=new Array(32),S=new Array(4),c=new Array(4),T=this.nextIndex++,m=this.nextIndex++;for(_=0;32>_;_++)l[_]=0,r[_]=this.nextIndex++,o[_]=this.nextIndex++;for(_=0;8>_;_++)A[_]=this.nextIndex++;for(_=0;4>_;_++)S[_]=this.nextIndex++;for(this.cmd("Step"),_=d.length-1;_>=0;_--){for(u=0;32>u;u++)this.cmd("CreateLabel",r[u],l[u],HASH_NUMBER_START_X+u*HASH_X_DIFF,HASH_NUMBER_START_Y,0);this.cmd("Delete",H[_]);for(var F=d[_].charCodeAt(0),u=7;u>=0;u--)a[u]=F%2,F=Math.floor(F/2),this.cmd("CreateLabel",A[u],a[u],HASH_INPUT_START_X+_*HASH_INPUT_X_DIFF,HASH_INPUT_START_Y,0),this.cmd("Move",A[u],HASH_NUMBER_START_X+(u+24)*HASH_X_DIFF,HASH_ADD_START_Y);this.cmd("Step"),this.cmd("CreateRectangle",m,"",32*HASH_X_DIFF,0,HASH_NUMBER_START_X,HASH_ADD_LINE_Y,"left","bottom"),this.cmd("CreateLabel",T,"+",HASH_NUMBER_START_X,HASH_ADD_START_Y,0),this.cmd("Step");var b=0;for(u=7;u>=0;u--)l[u+24]=l[u+24]+a[u]+b,l[u+24]>1?(l[u+24]=l[u+24]-2,b=1):b=0;for(u=23;u>=0;u--)l[u]=l[u]+b,l[u]>1?(l[u]=l[u]-2,b=1):b=0;for(u=0;32>u;u++)this.cmd("CreateLabel",o[u],l[u],HASH_NUMBER_START_X+u*HASH_X_DIFF,HASH_RESULT_Y,0);for(this.cmd("Step"),u=0;8>u;u++)this.cmd("Delete",A[u]);for(this.cmd("Delete",m),this.cmd("Delete",T),u=0;32>u;u++)this.cmd("Delete",r[u]),this.cmd("Move",o[u],HASH_NUMBER_START_X+u*HASH_X_DIFF,HASH_NUMBER_START_Y);if(this.cmd("Step"),_>0){for(u=0;32>u;u++)this.cmd("Move",o[u],HASH_NUMBER_START_X+(u-4)*HASH_X_DIFF,HASH_NUMBER_START_Y);for(this.cmd("Step"),u=0;28>u;u++)c[u]=l[u],l[u]=l[u+4];for(u=0;4>u;u++)this.cmd("Move",o[u],HASH_NUMBER_START_X+(u+ELF_HASH_SHIFT)*HASH_X_DIFF,HASH_ADD_START_Y),l[u+28]=0,this.cmd("CreateLabel",S[u],0,HASH_NUMBER_START_X+(u+28)*HASH_X_DIFF,HASH_NUMBER_START_Y,0),c[u]&&(l[u+ELF_HASH_SHIFT]=1-l[u+ELF_HASH_SHIFT]);for(this.cmd("CreateRectangle",m,"",32*HASH_X_DIFF,0,HASH_NUMBER_START_X,HASH_ADD_LINE_Y,"left","bottom"),this.cmd("CreateLabel",T,"XOR",HASH_NUMBER_START_X,HASH_ADD_START_Y,0),this.cmd("Step"),u=0;32>u;u++)this.cmd("CreateLabel",r[u],l[u],HASH_NUMBER_START_X+u*HASH_X_DIFF,HASH_RESULT_Y,0);for(this.cmd("Step"),this.cmd("Delete",T),this.cmd("Delete",m),u=0;32>u;u++)this.cmd("Delete",o[u]),this.cmd("Move",r[u],HASH_NUMBER_START_X+u*HASH_X_DIFF,HASH_NUMBER_START_Y);for(u=0;4>u;u++)this.cmd("Delete",S[u]);for(this.cmd("Step"),u=0;32>u;u++)this.cmd("Delete",r[u])}else for(u=0;32>u;u++)this.cmd("Delete",o[u])}for(this.cmd("Delete",n),u=0;32>u;u++)this.cmd("CreateLabel",r[u],l[u],HASH_NUMBER_START_X+u*HASH_X_DIFF,HASH_NUMBER_START_Y,0);for(this.currHash=0,u=0;32>u;u++)this.currHash=2*this.currHash+l[u];for(this.cmd("CreateLabel",n," = "+String(this.currHash),HASH_NUMBER_START_X+32*HASH_X_DIFF,HASH_NUMBER_START_Y,0),this.cmd("Step"),u=0;32>u;u++)this.cmd("Delete",r[u]);var R=this.nextIndex++;return this.cmd("SetText",n,String(this.currHash)+" % "+String(this.table_size)+" = "),h=this.currHash%this.table_size,this.cmd("CreateLabel",R,h,HASH_NUMBER_START_X+32*HASH_X_DIFF+105,HASH_NUMBER_START_Y,0),this.cmd("Step"),s=this.nextIndex++,this.cmd("CreateHighlightCircle",s,HIGHLIGHT_COLOR,HASH_NUMBER_START_X+30*HASH_X_DIFF+120,HASH_NUMBER_START_Y+15),this.cmd("Move",s,this.indexXPos[h],this.indexYPos[h]),this.cmd("Step"),this.cmd("Delete",s),this.cmd("Delete",n),this.cmd("Delete",R),h},Hash.prototype.resetAll=function(){return this.insertField.value="",this.deleteField.value="",this.findField.value="",[]},Hash.prototype.insertCallback=function(t){var e=this.insertField.value;""!=e&&(this.insertField.value="",this.implementAction(this.insertElement.bind(this),e))},Hash.prototype.deleteCallback=function(t){var e=this.deleteField.value;""!=e&&(this.deleteField.value="",this.implementAction(this.deleteElement.bind(this),e))},Hash.prototype.findCallback=function(t){var e=this.findField.value;""!=e&&(this.findField.value="",this.implementAction(this.findElement.bind(this),e))},Hash.prototype.insertElement=function(t){},Hash.prototype.deleteElement=function(t){},Hash.prototype.findElement=function(t){},Hash.prototype.reset=function(){this.hashIntegerButton.checked=!0},Hash.prototype.disableUI=function(t){this.insertField.disabled=!0,this.insertButton.disabled=!0,this.deleteField.disabled=!0,this.deleteButton.disabled=!0,this.findField.disabled=!0,this.findButton.disabled=!0},Hash.prototype.enableUI=function(t){this.insertField.disabled=!1,this.insertButton.disabled=!1,this.deleteField.disabled=!1,this.deleteButton.disabled=!1,this.findField.disabled=!1,this.findButton.disabled=!1};