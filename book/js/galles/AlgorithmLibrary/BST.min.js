// Copyright 2011 David Galles, University of San Francisco. All rights reserved.
//
// Redistribution and use in source and binary forms, with or without modification, are
// permitted provided that the following conditions are met:
//
// 1. Redistributions of source code must retain the above copyright notice, this list of
// conditions and the following disclaimer.
//
// 2. Redistributions in binary form must reproduce the above copyright notice, this list
// of conditions and the following disclaimer in the documentation and/or other materials
// provided with the distribution.
//
// THIS SOFTWARE IS PROVIDED BY David Galles ``AS IS'' AND ANY EXPRESS OR IMPLIED
// WARRANTIES, INCLUDING, BUT NOT LIMITED TO, THE IMPLIED WARRANTIES OF MERCHANTABILITY AND
// FITNESS FOR A PARTICULAR PURPOSE ARE DISCLAIMED. IN NO EVENT SHALL <COPYRIGHT HOLDER> OR
// CONTRIBUTORS BE LIABLE FOR ANY DIRECT, INDIRECT, INCIDENTAL, SPECIAL, EXEMPLARY, OR
// CONSEQUENTIAL DAMAGES (INCLUDING, BUT NOT LIMITED TO, PROCUREMENT OF SUBSTITUTE GOODS OR
// SERVICES; LOSS OF USE, DATA, OR PROFITS; OR BUSINESS INTERRUPTION) HOWEVER CAUSED AND ON
// ANY THEORY OF LIABILITY, WHETHER IN CONTRACT, STRICT LIABILITY, OR TORT (INCLUDING
// NEGLIGENCE OR OTHERWISE) ARISING IN ANY WAY OUT OF THE USE OF THIS SOFTWARE, EVEN IF
// ADVISED OF THE POSSIBILITY OF SUCH DAMAGE.
//
// The views and conclusions contained in the software and documentation are those of the
// authors and should not be interpreted as representing official policies, either expressed
// or implied, of the University of San Francisco


// Constants.

function BST(t,e,i){this.init(t,e,i)}function BSTNode(t,e,i,h){this.data=t,this.x=i,this.y=h,this.graphicID=e,this.left=null,this.right=null,this.parent=null}function init(){var t=initCanvas();currentAlg=new BST(t,canvas.width,canvas.height)}BST.LINK_COLOR="#000000",BST.HIGHLIGHT_CIRCLE_COLOR="#007700",BST.FOREGROUND_COLOR="#000000",BST.BACKGROUND_COLOR="#EEEEEE",BST.PRINT_COLOR=BST.FOREGROUND_COLOR,BST.WIDTH_DELTA=50,BST.HEIGHT_DELTA=50,BST.STARTING_Y=50,BST.FIRST_PRINT_POS_X=50,BST.PRINT_VERTICAL_GAP=20,BST.PRINT_HORIZONTAL_GAP=50,BST.prototype=new Algorithm,BST.prototype.constructor=BST,BST.superclass=Algorithm.prototype,BST.prototype.init=function(t,e,i){var h=BST.superclass;this.startingX=e/2,this.first_print_pos_y=i-2*BST.PRINT_VERTICAL_GAP,this.print_max=e-10;var s=h.init;s.call(this,t),this.addControls(),this.nextIndex=0,this.commands=[],this.cmd("CreateLabel",0,"",20,10,0),this.nextIndex=1,this.animationManager.StartNewAnimation(this.commands),this.animationManager.skipForward(),this.animationManager.clearHistory()},BST.prototype.addControls=function(){this.insertField=addControlToAlgorithmBar("Text",""),this.insertField.onkeydown=this.returnSubmit(this.insertField,this.insertCallback.bind(this),4),this.insertButton=addControlToAlgorithmBar("Button","Dodaj"),this.insertButton.onclick=this.insertCallback.bind(this),this.deleteField=addControlToAlgorithmBar("Text",""),this.deleteField.onkeydown=this.returnSubmit(this.deleteField,this.deleteCallback.bind(this),4),this.deleteButton=addControlToAlgorithmBar("Button","Odstrani"),this.deleteButton.onclick=this.deleteCallback.bind(this),this.findField=addControlToAlgorithmBar("Text",""),this.findField.onkeydown=this.returnSubmit(this.findField,this.findCallback.bind(this),4),this.findButton=addControlToAlgorithmBar("Button","Najdi"),this.findButton.onclick=this.findCallback.bind(this),this.printButton=addControlToAlgorithmBar("Button","Sprehod"),this.printButton.onclick=this.printCallback.bind(this)},BST.prototype.reset=function(){this.nextIndex=1,this.treeRoot=null},BST.prototype.insertCallback=function(t){var e=this.insertField.value;e=this.normalizeNumber(e,4),""!=e&&(this.insertField.value="",this.implementAction(this.insertElement.bind(this),e))},BST.prototype.deleteCallback=function(t){var e=this.deleteField.value;""!=e&&(e=this.normalizeNumber(e,4),this.deleteField.value="",this.implementAction(this.deleteElement.bind(this),e))},BST.prototype.printCallback=function(t){this.implementAction(this.printTree.bind(this),"")},BST.prototype.printTree=function(t){if(this.commands=[],null!=this.treeRoot){this.highlightID=this.nextIndex++;var e=this.nextIndex;this.cmd("CreateHighlightCircle",this.highlightID,BST.HIGHLIGHT_CIRCLE_COLOR,this.treeRoot.x,this.treeRoot.y),this.xPosOfNextLabel=BST.FIRST_PRINT_POS_X,this.yPosOfNextLabel=this.first_print_pos_y,this.printTreeRec(this.treeRoot),this.cmd("Delete",this.highlightID),this.cmd("Step");for(var i=e;i<this.nextIndex;i++)this.cmd("Delete",i);this.nextIndex=this.highlightID}return this.commands},BST.prototype.printTreeRec=function(t){this.cmd("Step"),null!=t.left&&(this.cmd("Move",this.highlightID,t.left.x,t.left.y),this.printTreeRec(t.left),this.cmd("Move",this.highlightID,t.x,t.y),this.cmd("Step"));var e=this.nextIndex++;this.cmd("CreateLabel",e,t.data,t.x,t.y),this.cmd("SetForegroundColor",e,BST.PRINT_COLOR),this.cmd("Move",e,this.xPosOfNextLabel,this.yPosOfNextLabel),this.cmd("Step"),this.xPosOfNextLabel+=BST.PRINT_HORIZONTAL_GAP,this.xPosOfNextLabel>this.print_max&&(this.xPosOfNextLabel=BST.FIRST_PRINT_POS_X,this.yPosOfNextLabel+=BST.PRINT_VERTICAL_GAP),null!=t.right&&(this.cmd("Move",this.highlightID,t.right.x,t.right.y),this.printTreeRec(t.right),this.cmd("Move",this.highlightID,t.x,t.y),this.cmd("Step"))},BST.prototype.findCallback=function(t){var e;e=this.normalizeNumber(this.findField.value,4),this.findField.value="",this.implementAction(this.findElement.bind(this),e)},BST.prototype.findElement=function(t){return this.commands=[],this.highlightID=this.nextIndex++,this.doFind(this.treeRoot,t),this.commands},BST.prototype.doFind=function(t,e){this.cmd("SetText",0,"Iskanje "+e),null!=t?(this.cmd("SetHighlight",t.graphicID,1),t.data==e?(this.cmd("SetText",0,"Iskanje "+e+" : "+e+" = "+e+" (Element najden!)"),this.cmd("Step"),this.cmd("SetText",0,"Najdeno: "+e),this.cmd("SetHighlight",t.graphicID,0)):t.data>e?(this.cmd("SetText",0,"Iskanje "+e+" : "+e+" < "+t.data+" (poglej v levo poddrevo)"),this.cmd("Step"),this.cmd("SetHighlight",t.graphicID,0),null!=t.left&&(this.cmd("CreateHighlightCircle",this.highlightID,BST.HIGHLIGHT_CIRCLE_COLOR,t.x,t.y),this.cmd("Move",this.highlightID,t.left.x,t.left.y),this.cmd("Step"),this.cmd("Delete",this.highlightID)),this.doFind(t.left,e)):(this.cmd("SetText",0,"Iskanje "+e+" : "+e+" > "+t.data+" (poglej v desno poddrevo)"),this.cmd("Step"),this.cmd("SetHighlight",t.graphicID,0),null!=t.right&&(this.cmd("CreateHighlightCircle",this.highlightID,BST.HIGHLIGHT_CIRCLE_COLOR,t.x,t.y),this.cmd("Move",this.highlightID,t.right.x,t.right.y),this.cmd("Step"),this.cmd("Delete",this.highlightID)),this.doFind(t.right,e))):(this.cmd("SetText",0,"Iskanje "+e+" : < Prazno drevo > (Ne najdem elementa)"),this.cmd("Step"),this.cmd("SetText",0,"Iskanje "+e+" :  (Ne najdem elementa)"))},BST.prototype.insertElement=function(t){if(this.commands=new Array,this.cmd("SetText",0,"Dodajanje "+t),this.highlightID=this.nextIndex++,null==this.treeRoot)this.cmd("CreateCircle",this.nextIndex,t,this.startingX,BST.STARTING_Y),this.cmd("SetForegroundColor",this.nextIndex,BST.FOREGROUND_COLOR),this.cmd("SetBackgroundColor",this.nextIndex,BST.BACKGROUND_COLOR),this.cmd("Step"),this.treeRoot=new BSTNode(t,this.nextIndex,this.startingX,BST.STARTING_Y),this.nextIndex+=1;else{this.cmd("CreateCircle",this.nextIndex,t,100,100),this.cmd("SetForegroundColor",this.nextIndex,BST.FOREGROUND_COLOR),this.cmd("SetBackgroundColor",this.nextIndex,BST.BACKGROUND_COLOR),this.cmd("Step");var e=new BSTNode(t,this.nextIndex,100,100);this.nextIndex+=1,this.cmd("SetHighlight",e.graphicID,1),this.insert(e,this.treeRoot),this.resizeTree()}return this.cmd("SetText",0,""),this.commands},BST.prototype.insert=function(t,e){this.cmd("SetHighlight",e.graphicID,1),this.cmd("SetHighlight",t.graphicID,1),t.data<e.data?this.cmd("SetText",0,t.data+" < "+e.data+".  Iskanje v levem poddrevesu"):this.cmd("SetText",0,t.data+" >= "+e.data+".  Iskanje v desnem poddrevesu"),this.cmd("Step"),this.cmd("SetHighlight",e.graphicID,0),this.cmd("SetHighlight",t.graphicID,0),t.data<e.data?null==e.left?(this.cmd("SetText",0,"Našel prazno drevo, dodajam element"),this.cmd("SetHighlight",t.graphicID,0),e.left=t,t.parent=e,this.cmd("Connect",e.graphicID,t.graphicID,BST.LINK_COLOR)):(this.cmd("CreateHighlightCircle",this.highlightID,BST.HIGHLIGHT_CIRCLE_COLOR,e.x,e.y),this.cmd("Move",this.highlightID,e.left.x,e.left.y),this.cmd("Step"),this.cmd("Delete",this.highlightID),this.insert(t,e.left)):null==e.right?(this.cmd("SetText",0,"Našel prazno drevo, dodajam element"),this.cmd("SetHighlight",t.graphicID,0),e.right=t,t.parent=e,this.cmd("Connect",e.graphicID,t.graphicID,BST.LINK_COLOR),t.x=e.x+BST.WIDTH_DELTA/2,t.y=e.y+BST.HEIGHT_DELTA,this.cmd("Move",t.graphicID,t.x,t.y)):(this.cmd("CreateHighlightCircle",this.highlightID,BST.HIGHLIGHT_CIRCLE_COLOR,e.x,e.y),this.cmd("Move",this.highlightID,e.right.x,e.right.y),this.cmd("Step"),this.cmd("Delete",this.highlightID),this.insert(t,e.right))},BST.prototype.deleteElement=function(t){return this.commands=[],this.cmd("SetText",0,"Odstranjujem "+t),this.cmd("Step"),this.cmd("SetText",0,""),this.highlightID=this.nextIndex++,this.treeDelete(this.treeRoot,t),this.cmd("SetText",0,""),this.commands},BST.prototype.treeDelete=function(t,e){var i=!1;if(null!=t)if(null!=t.parent&&(i=t.parent.left==t),this.cmd("SetHighlight",t.graphicID,1),e<t.data?this.cmd("SetText",0,e+" < "+t.data+".  Iskanje v levem poddrevesu"):e>t.data?this.cmd("SetText",0,e+" > "+t.data+".  Iskanje v desnem poddrevesu"):this.cmd("SetText",0,e+" == "+t.data+".  Našel vozlišèe za odstranitev"),this.cmd("Step"),this.cmd("SetHighlight",t.graphicID,0),e==t.data)if(null==t.left&&null==t.right)this.cmd("SetText",0,"Vozlišèe je list. Odstrani ga."),this.cmd("Delete",t.graphicID),i&&null!=t.parent?t.parent.left=null:null!=t.parent?t.parent.right=null:treeRoot=null,this.resizeTree(),this.cmd("Step");else if(null==t.left)this.cmd("SetText",0,"Vozlišèe nima levega otroka.  \nNastavi starša odstranjenega vozlišèa na desnega otroka odstranjenega vozlišèa."),null!=t.parent?(this.cmd("Disconnect",t.parent.graphicID,t.graphicID),this.cmd("Connect",t.parent.graphicID,t.right.graphicID,BST.LINK_COLOR),this.cmd("Step"),this.cmd("Delete",t.graphicID),i?t.parent.left=t.right:t.parent.right=t.right,t.right.parent=t.parent):(this.cmd("Delete",t.graphicID),this.treeRoot=t.right,this.treeRoot.parent=null),this.resizeTree();else if(null==t.right)this.cmd("SetText",0,"Vozlišèe nima desnega otroka.  \nNastavi starša odstranjenega vozlišèa na levega otroka odstranjenega vozlišèa."),null!=t.parent?(this.cmd("Disconnect",t.parent.graphicID,t.graphicID),this.cmd("Connect",t.parent.graphicID,t.left.graphicID,BST.LINK_COLOR),this.cmd("Step"),this.cmd("Delete",t.graphicID),i?t.parent.left=t.left:t.parent.right=t.left,t.left.parent=t.parent):(this.cmd("Delete",t.graphicID),this.treeRoot=t.left,this.treeRoot.parent=null),this.resizeTree();else{this.cmd("SetText",0,"Vozlišèe ima dva otroka.  \nNajdi najveèje vozlišèe v levem poddrevesu."),this.highlightID=this.nextIndex,this.nextIndex+=1,this.cmd("CreateHighlightCircle",this.highlightID,BST.HIGHLIGHT_CIRCLE_COLOR,t.x,t.y);var h=t;for(h=t.left,this.cmd("Move",this.highlightID,h.x,h.y),this.cmd("Step");null!=h.right;)h=h.right,this.cmd("Move",this.highlightID,h.x,h.y),this.cmd("Step");this.cmd("SetText",t.graphicID," ");var s=this.nextIndex;this.nextIndex+=1,this.cmd("CreateLabel",s,h.data,h.x,h.y),t.data=h.data,this.cmd("Move",s,t.x,t.y),this.cmd("SetText",0,"Kopiraj najveèjo vrednost levega poddrevesa v odstranjeno vozlišèe."),this.cmd("Step"),this.cmd("SetHighlight",t.graphicID,0),this.cmd("Delete",s),this.cmd("SetText",t.graphicID,t.data),this.cmd("Delete",this.highlightID),this.cmd("SetText",0,"Odstrani vozlišèe, katerega vrednost si kopiral."),null==h.left?(h.parent!=t?h.parent.right=null:t.left=null,this.cmd("Delete",h.graphicID),this.resizeTree()):(this.cmd("Disconnect",h.parent.graphicID,h.graphicID),this.cmd("Connect",h.parent.graphicID,h.left.graphicID,BST.LINK_COLOR),this.cmd("Step"),this.cmd("Delete",h.graphicID),h.parent!=t?(h.parent.right=h.left,h.left.parent=h.parent):(t.left=h.left,h.left.parent=t),this.resizeTree())}else e<t.data?(null!=t.left&&(this.cmd("CreateHighlightCircle",this.highlightID,BST.HIGHLIGHT_CIRCLE_COLOR,t.x,t.y),this.cmd("Move",this.highlightID,t.left.x,t.left.y),this.cmd("Step"),this.cmd("Delete",this.highlightID)),this.treeDelete(t.left,e)):(null!=t.right&&(this.cmd("CreateHighlightCircle",this.highlightID,BST.HIGHLIGHT_CIRCLE_COLOR,t.x,t.y),this.cmd("Move",this.highlightID,t.right.x,t.right.y),this.cmd("Step"),this.cmd("Delete",this.highlightID)),this.treeDelete(t.right,e));else this.cmd("SetText",0,"Elementa "+e+" ne najdem in ga ne morem odstraniti.")},BST.prototype.resizeTree=function(){var t=this.startingX;this.resizeWidths(this.treeRoot),null!=this.treeRoot&&(this.treeRoot.leftWidth>t?t=this.treeRoot.leftWidth:this.treeRoot.rightWidth>t&&(t=Math.max(this.treeRoot.leftWidth,2*t-this.treeRoot.rightWidth)),this.setNewPositions(this.treeRoot,t,BST.STARTING_Y,0),this.animateNewPositions(this.treeRoot),this.cmd("Step"))},BST.prototype.setNewPositions=function(t,e,i,h){null!=t&&(t.y=i,-1==h?e-=t.rightWidth:1==h&&(e+=t.leftWidth),t.x=e,this.setNewPositions(t.left,e,i+BST.HEIGHT_DELTA,-1),this.setNewPositions(t.right,e,i+BST.HEIGHT_DELTA,1))},BST.prototype.animateNewPositions=function(t){null!=t&&(this.cmd("Move",t.graphicID,t.x,t.y),this.animateNewPositions(t.left),this.animateNewPositions(t.right))},BST.prototype.resizeWidths=function(t){return null==t?0:(t.leftWidth=Math.max(this.resizeWidths(t.left),BST.WIDTH_DELTA/2),t.rightWidth=Math.max(this.resizeWidths(t.right),BST.WIDTH_DELTA/2),t.leftWidth+t.rightWidth)},BST.prototype.disableUI=function(t){this.insertField.disabled=!0,this.insertButton.disabled=!0,this.deleteField.disabled=!0,this.deleteButton.disabled=!0,this.findField.disabled=!0,this.findButton.disabled=!0,this.printButton.disabled=!0},BST.prototype.enableUI=function(t){this.insertField.disabled=!1,this.insertButton.disabled=!1,this.deleteField.disabled=!1,this.deleteButton.disabled=!1,this.findField.disabled=!1,this.findButton.disabled=!1,this.printButton.disabled=!1};var currentAlg;