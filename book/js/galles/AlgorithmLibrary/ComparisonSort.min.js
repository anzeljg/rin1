// Copyright 2011 David Galles, University of San Francisco. All rights reserved.
//
// Redistribution and use in source and binary forms, with or without modification, are
// permitted provided that the following conditions are met:
//
// 1. Redistributions of source code must retain the above copyright notice, this list of
// conditions and the following disclaimer.
//
// 2. Redistributions in binary form must reproduce the above copyright notice, this list
// of conditions and the following disclaimer in the documentation and/or other materials
// provided with the distribution.
//
// THIS SOFTWARE IS PROVIDED BY <COPYRIGHT HOLDER> ``AS IS'' AND ANY EXPRESS OR IMPLIED
// WARRANTIES, INCLUDING, BUT NOT LIMITED TO, THE IMPLIED WARRANTIES OF MERCHANTABILITY AND
// FITNESS FOR A PARTICULAR PURPOSE ARE DISCLAIMED. IN NO EVENT SHALL <COPYRIGHT HOLDER> OR
// CONTRIBUTORS BE LIABLE FOR ANY DIRECT, INDIRECT, INCIDENTAL, SPECIAL, EXEMPLARY, OR
// CONSEQUENTIAL DAMAGES (INCLUDING, BUT NOT LIMITED TO, PROCUREMENT OF SUBSTITUTE GOODS OR
// SERVICES; LOSS OF USE, DATA, OR PROFITS; OR BUSINESS INTERRUPTION) HOWEVER CAUSED AND ON
// ANY THEORY OF LIABILITY, WHETHER IN CONTRACT, STRICT LIABILITY, OR TORT (INCLUDING
// NEGLIGENCE OR OTHERWISE) ARISING IN ANY WAY OUT OF THE USE OF THIS SOFTWARE, EVEN IF
// ADVISED OF THE POSSIBILITY OF SUCH DAMAGE.
//
// The views and conclusions contained in the software and documentation are those of the
// authors and should not be interpreted as representing official policies, either expressed
// or implied, of the University of San Francisco

function ComparisonSort(t,s,r){this.init(t,s,r)}function init(){var t=initCanvas();currentAlg=new ComparisonSort(t,canvas.width,canvas.height)}var ARRAY_SIZE_SMALL=25,ARRAY_WIDTH_SMALL=32,ARRAY_BAR_WIDTH_SMALL=26,ARRAY_INITIAL_X_SMALL=15,ARRAY_Y_POS=250,ARRAY_LABEL_Y_POS=260,LOWER_ARRAY_Y_POS=400,LOWER_ARRAY_LABEL_Y_POS=410,SCALE_FACTOR=2,ARRAY_SIZE_LARGE=200,ARRAY_WIDTH_LARGE=4,ARRAY_BAR_WIDTH_LARGE=2,ARRAY_INITIAL_X_LARGE=15,BAR_FOREGROUND_COLOR="#0000FF",BAR_BACKGROUND_COLOR="#AAAAFF",INDEX_COLOR="#0000FF",HIGHLIGHT_BAR_COLOR="#FF0000",HIGHLIGHT_BAR_BACKGROUND_COLOR="#FFAAAA",QUICKSORT_LINE_COLOR="#FF0000";ComparisonSort.prototype=new Algorithm,ComparisonSort.prototype.constructor=ComparisonSort,ComparisonSort.superclass=Algorithm.prototype,ComparisonSort.prototype.init=function(t,s,r){var i=ComparisonSort.superclass,a=i.init;a.call(this,t),this.addControls(),this.nextIndex=0,this.setArraySize(!0),this.arrayData=new Array(ARRAY_SIZE_LARGE),this.arraySwap=new Array(ARRAY_SIZE_LARGE),this.labelsSwap=new Array(ARRAY_SIZE_LARGE),this.objectsSwap=new Array(ARRAY_SIZE_LARGE),this.createVisualObjects()},ComparisonSort.prototype.addControls=function(){this.resetButton=addControlToAlgorithmBar("Button","Premešaj podatke"),this.resetButton.onclick=this.resetCallback.bind(this),this.insertSortButton=addControlToAlgorithmBar("Button","Insertion Sort"),this.insertSortButton.onclick=this.insertSortCallback.bind(this),this.selectSortButton=addControlToAlgorithmBar("Button","Selection Sort"),this.selectSortButton.onclick=this.selectSortCallback.bind(this),this.bubbleSortButton=addControlToAlgorithmBar("Button","Bubble Sort"),this.bubbleSortButton.onclick=this.bubbleSortCallback.bind(this),this.quickSortButton=addControlToAlgorithmBar("Button","Quick Sort"),this.quickSortButton.onclick=this.quickSortCallback.bind(this),this.mergeSortButton=addControlToAlgorithmBar("Button","Merge Sort"),this.mergeSortButton.onclick=this.mergeSortCallback.bind(this),this.shellSortButton=addControlToAlgorithmBar("Button","Shell Sort"),this.shellSortButton.onclick=this.shellSortCallback.bind(this)},ComparisonSort.prototype.setArraySize=function(t){t?(this.array_size=ARRAY_SIZE_SMALL,this.array_width=ARRAY_WIDTH_SMALL,this.array_bar_width=ARRAY_BAR_WIDTH_SMALL,this.array_initial_x=ARRAY_INITIAL_X_SMALL,this.array_y_pos=ARRAY_Y_POS,this.array_label_y_pos=ARRAY_LABEL_Y_POS,this.showLabels=!0):(this.array_size=ARRAY_SIZE_LARGE,this.array_width=ARRAY_WIDTH_LARGE,this.array_bar_width=ARRAY_BAR_WIDTH_LARGE,this.array_initial_x=ARRAY_INITIAL_X_LARGE,this.array_y_pos=ARRAY_Y_POS,this.array_label_y_pos=ARRAY_LABEL_Y_POS,this.showLabels=!1)},ComparisonSort.prototype.resetAll=function(t){this.animationManager.resetAll(),this.setArraySize(!t),this.nextIndex=0,this.createVisualObjects()},ComparisonSort.prototype.randomizeArray=function(){this.commands=new Array;for(var t=0;t<this.array_size;t++)this.arrayData[t]=Math.floor(1+99*Math.random()),this.oldData[t]=this.arrayData[t],this.showLabels?this.cmd("SetText",this.barLabels[t],this.arrayData[t]):this.cmd("SetText",this.barLabels[t],""),this.cmd("SetHeight",this.barObjects[t],this.arrayData[t]*SCALE_FACTOR);this.animationManager.StartNewAnimation(this.commands),this.animationManager.skipForward(),this.animationManager.clearHistory()},ComparisonSort.prototype.swap=function(t,s){var r=this.arrayData[t];this.arrayData[t]=this.arrayData[s],this.arrayData[s]=r,r=this.barObjects[t],this.barObjects[t]=this.barObjects[s],this.barObjects[s]=r,r=this.barLabels[t],this.barLabels[t]=this.barLabels[s],this.barLabels[s]=r,this.cmd("Move",this.barObjects[t],this.barPositionsX[t],this.array_y_pos),this.cmd("Move",this.barObjects[s],this.barPositionsX[s],this.array_y_pos),this.cmd("Move",this.barLabels[t],this.barPositionsX[t],this.array_label_y_pos),this.cmd("Move",this.barLabels[s],this.barPositionsX[s],this.array_label_y_pos),this.cmd("Step")},ComparisonSort.prototype.createVisualObjects=function(){this.barObjects=new Array(this.array_size),this.oldBarObjects=new Array(this.array_size),this.oldbarLabels=new Array(this.array_size),this.barLabels=new Array(this.array_size),this.barPositionsX=new Array(this.array_size),this.oldData=new Array(this.array_size),this.obscureObject=new Array(this.array_size);var t=this.array_initial_x,s=this.array_y_pos,r=this.array_label_y_pos;this.commands=new Array;for(var i=0;i<this.array_size;i++)t+=this.array_width,this.barPositionsX[i]=t,this.cmd("CreateRectangle",this.nextIndex,"",this.array_bar_width,200,t,s,"center","bottom"),this.cmd("SetForegroundColor",this.nextIndex,BAR_FOREGROUND_COLOR),this.cmd("SetBackgroundColor",this.nextIndex,BAR_BACKGROUND_COLOR),this.barObjects[i]=this.nextIndex,this.oldBarObjects[i]=this.barObjects[i],this.nextIndex+=1,this.showLabels?this.cmd("CreateLabel",this.nextIndex,"99",t,r):this.cmd("CreateLabel",this.nextIndex,"",t,r),this.cmd("SetForegroundColor",this.nextIndex,INDEX_COLOR),this.barLabels[i]=this.nextIndex,this.oldbarLabels[i]=this.barLabels[i],++this.nextIndex;for(this.animationManager.StartNewAnimation(this.commands),this.animationManager.skipForward(),this.randomizeArray(),i=0;i<this.array_size;i++)this.obscureObject[i]=!1;this.lastCreatedIndex=this.nextIndex},ComparisonSort.prototype.highlightRange=function(t,s){for(var r=0;t>r;r++)this.obscureObject[r]||(this.obscureObject[r]=!0,this.cmd("SetAlpha",this.barObjects[r],.08),this.cmd("SetAlpha",this.barLabels[r],.08));for(r=t;s>=r;r++)this.obscureObject[r]&&(this.obscureObject[r]=!1,this.cmd("SetAlpha",this.barObjects[r],1),this.cmd("SetAlpha",this.barLabels[r],1));for(r=s+1;r<this.array_size;r++)this.obscureObject[r]||(this.obscureObject[r]=!0,this.cmd("SetAlpha",this.barObjects[r],.08),this.cmd("SetAlpha",this.barLabels[r],.08))},ComparisonSort.prototype.reset=function(){for(var t=0;t<this.array_size;t++)this.arrayData[t]=this.oldData[t],this.barObjects[t]=this.oldBarObjects[t],this.barLabels[t]=this.oldbarLabels[t],this.showLabels?this.cmd("SetText",this.barLabels[t],this.arrayData[t]):this.cmd("SetText",this.barLabels[t],""),this.cmd("SetHeight",this.barObjects[t],this.arrayData[t]*SCALE_FACTOR);this.commands=new Array},ComparisonSort.prototype.resetCallback=function(t){this.randomizeArray()},ComparisonSort.prototype.insertSortCallback=function(t){this.animationManager.clearHistory(),this.commands=new Array,this.insertionSortSkip(1,0),this.animationManager.StartNewAnimation(this.commands),this.commands=new Array},ComparisonSort.prototype.selectSortCallback=function(t){this.commands=new Array,this.animationManager.clearHistory();for(var s=0;s<this.array_size-1;s++){var r=s;this.cmd("SetForegroundColor",this.barObjects[r],HIGHLIGHT_BAR_COLOR),this.cmd("SetBackgroundColor",this.barObjects[r],HIGHLIGHT_BAR_BACKGROUND_COLOR);for(var i=s+1;i<this.array_size;i++)this.cmd("SetForegroundColor",this.barObjects[i],HIGHLIGHT_BAR_COLOR),this.cmd("SetBackgroundColor",this.barObjects[i],HIGHLIGHT_BAR_BACKGROUND_COLOR),this.cmd("Step"),this.arrayData[i]<this.arrayData[r]?(this.cmd("SetForegroundColor",this.barObjects[r],BAR_FOREGROUND_COLOR),this.cmd("SetBackgroundColor",this.barObjects[r],BAR_BACKGROUND_COLOR),r=i):(this.cmd("SetForegroundColor",this.barObjects[i],BAR_FOREGROUND_COLOR),this.cmd("SetBackgroundColor",this.barObjects[i],BAR_BACKGROUND_COLOR));r!=s&&this.swap(r,s),this.cmd("SetForegroundColor",this.barObjects[s],BAR_FOREGROUND_COLOR),this.cmd("SetBackgroundColor",this.barObjects[s],BAR_BACKGROUND_COLOR)}this.animationManager.StartNewAnimation(this.commands)},ComparisonSort.prototype.bubbleSortCallback=function(t){this.animationManager.clearHistory(),this.commands=new Array;for(var s=this.array_size-1;s>0;s--)for(var r=0;s>r;r++)this.cmd("SetForegroundColor",this.barObjects[r],HIGHLIGHT_BAR_COLOR),this.cmd("SetBackgroundColor",this.barObjects[r],HIGHLIGHT_BAR_BACKGROUND_COLOR),this.cmd("SetForegroundColor",this.barObjects[r+1],HIGHLIGHT_BAR_COLOR),this.cmd("SetBackgroundColor",this.barObjects[r+1],HIGHLIGHT_BAR_BACKGROUND_COLOR),this.cmd("Step"),this.arrayData[r]>this.arrayData[r+1]&&this.swap(r,r+1),this.cmd("SetForegroundColor",this.barObjects[r],BAR_FOREGROUND_COLOR),this.cmd("SetBackgroundColor",this.barObjects[r],BAR_BACKGROUND_COLOR),this.cmd("SetForegroundColor",this.barObjects[r+1],BAR_FOREGROUND_COLOR),this.cmd("SetBackgroundColor",this.barObjects[r+1],BAR_BACKGROUND_COLOR);this.animationManager.StartNewAnimation(this.commands)},ComparisonSort.prototype.quickSortCallback=function(t){this.animationManager.clearHistory(),this.commands=new Array,this.iID=this.nextIndex++,this.jID=this.nextIndex++,this.cmd("CreateLabel",this.iID,"i",this.barObjects[0],this.array_label_y_pos+20),this.cmd("CreateLabel",this.jID,"j",this.barObjects[this.array_size-1],this.array_label_y_pos+20),this.cmd("SetForegroundColor",this.iID,HIGHLIGHT_BAR_COLOR),this.cmd("SetBackgroundColor",this.iID,HIGHLIGHT_BAR_BACKGROUND_COLOR),this.cmd("SetForegroundColor",this.jID,HIGHLIGHT_BAR_COLOR),this.cmd("SetBackgroundColor",this.jID,HIGHLIGHT_BAR_BACKGROUND_COLOR),this.doQuickSort(0,this.array_size-1),this.cmd("Delete",this.iID),this.cmd("Delete",this.jID),this.animationManager.StartNewAnimation(this.commands)},ComparisonSort.prototype.doQuickSort=function(t,s){if(this.highlightRange(t,s),!(t>=s)){this.cmd("Step");var r=this.nextIndex,i=this.arrayData[t];this.cmd("CreateRectangle",r,"",(this.array_size+1)*this.array_width,0,this.array_initial_x,this.array_y_pos-2*i,"left","bottom"),this.cmd("SetForegroundColor",r,QUICKSORT_LINE_COLOR);var a=t+1,o=s;for(this.cmd("Move",this.iID,this.barPositionsX[a],this.array_label_y_pos+20),this.cmd("Move",this.jID,this.barPositionsX[o],this.array_label_y_pos+20),this.cmd("Step");o>=a;){for(this.cmd("SetForegroundColor",this.barObjects[a],HIGHLIGHT_BAR_COLOR),this.cmd("SetBackgroundColor",this.barObjects[a],HIGHLIGHT_BAR_BACKGROUND_COLOR),this.cmd("SetForegroundColor",this.barObjects[t],HIGHLIGHT_BAR_COLOR),this.cmd("SetBackgroundColor",this.barObjects[t],HIGHLIGHT_BAR_BACKGROUND_COLOR),this.cmd("Step"),this.cmd("SetForegroundColor",this.barObjects[t],BAR_FOREGROUND_COLOR),this.cmd("SetBackgroundColor",this.barObjects[t],BAR_BACKGROUND_COLOR),this.cmd("SetForegroundColor",this.barObjects[a],BAR_FOREGROUND_COLOR),this.cmd("SetBackgroundColor",this.barObjects[a],BAR_BACKGROUND_COLOR);o>=a&&this.arrayData[a]<i;)++a,this.cmd("Move",this.iID,this.barPositionsX[a],this.array_label_y_pos+20),this.cmd("Step"),this.cmd("SetForegroundColor",this.barObjects[t],HIGHLIGHT_BAR_COLOR),this.cmd("SetBackgroundColor",this.barObjects[t],HIGHLIGHT_BAR_BACKGROUND_COLOR),this.cmd("SetForegroundColor",this.barObjects[a],HIGHLIGHT_BAR_COLOR),this.cmd("SetBackgroundColor",this.barObjects[a],HIGHLIGHT_BAR_BACKGROUND_COLOR),this.cmd("Step"),this.cmd("SetForegroundColor",this.barObjects[t],BAR_FOREGROUND_COLOR),this.cmd("SetBackgroundColor",this.barObjects[t],BAR_BACKGROUND_COLOR),this.cmd("SetForegroundColor",this.barObjects[a],BAR_FOREGROUND_COLOR),this.cmd("SetBackgroundColor",this.barObjects[a],BAR_BACKGROUND_COLOR);for(this.cmd("SetForegroundColor",this.barObjects[o],HIGHLIGHT_BAR_COLOR),this.cmd("SetBackgroundColor",this.barObjects[o],HIGHLIGHT_BAR_BACKGROUND_COLOR),this.cmd("SetForegroundColor",this.barObjects[t],HIGHLIGHT_BAR_COLOR),this.cmd("SetBackgroundColor",this.barObjects[t],HIGHLIGHT_BAR_BACKGROUND_COLOR),this.cmd("Step"),this.cmd("SetForegroundColor",this.barObjects[o],BAR_FOREGROUND_COLOR),this.cmd("SetBackgroundColor",this.barObjects[o],BAR_BACKGROUND_COLOR),this.cmd("SetForegroundColor",this.barObjects[t],BAR_FOREGROUND_COLOR),this.cmd("SetBackgroundColor",this.barObjects[t],BAR_BACKGROUND_COLOR);o>=a&&this.arrayData[o]>i;)--o,this.cmd("Move",this.jID,this.barPositionsX[o],this.array_label_y_pos+20),this.cmd("Step"),this.cmd("SetForegroundColor",this.barObjects[o],HIGHLIGHT_BAR_COLOR),this.cmd("SetBackgroundColor",this.barObjects[o],HIGHLIGHT_BAR_BACKGROUND_COLOR),this.cmd("SetForegroundColor",this.barObjects[t],HIGHLIGHT_BAR_COLOR),this.cmd("SetBackgroundColor",this.barObjects[t],HIGHLIGHT_BAR_BACKGROUND_COLOR),this.cmd("Step"),this.cmd("SetForegroundColor",this.barObjects[o],BAR_FOREGROUND_COLOR),this.cmd("SetBackgroundColor",this.barObjects[o],BAR_BACKGROUND_COLOR),this.cmd("SetForegroundColor",this.barObjects[t],BAR_FOREGROUND_COLOR),this.cmd("SetBackgroundColor",this.barObjects[t],BAR_BACKGROUND_COLOR);o>=a&&(this.cmd("Move",this.jID,this.barPositionsX[o-1],this.array_label_y_pos+20),this.cmd("Move",this.iID,this.barPositionsX[a+1],this.array_label_y_pos+20),this.swap(a,o),++a,--o)}a>=t&&(this.cmd("SetForegroundColor",this.barObjects[a],BAR_FOREGROUND_COLOR),this.cmd("SetBackgroundColor",this.barObjects[a],BAR_BACKGROUND_COLOR)),s>=o&&(this.cmd("SetForegroundColor",this.barObjects[o],BAR_FOREGROUND_COLOR),this.cmd("SetBackgroundColor",this.barObjects[o],BAR_BACKGROUND_COLOR)),this.swap(t,o),this.cmd("Step"),this.cmd("Delete",r),this.doQuickSort(t,o-1),this.doQuickSort(o+1,s),this.highlightRange(t,s)}},ComparisonSort.prototype.mergeSortCallback=function(t){this.animationManager.clearHistory(),this.commands=new Array,this.doMergeSort(0,this.array_size-1),this.animationManager.StartNewAnimation(this.commands)},ComparisonSort.prototype.doMergeSort=function(t,s){if(this.highlightRange(t,s),s>t){this.cmd("Step");var r=Math.floor((t+s)/2);this.doMergeSort(t,r),this.doMergeSort(r+1,s),this.highlightRange(t,s);for(var i=t,a=t,o=r+1;s>=i;)r>=a&&(o>s||this.arrayData[a]<=this.arrayData[o])?(this.arraySwap[i]=this.arrayData[a],this.cmd("Move",this.barObjects[a],this.barPositionsX[i],LOWER_ARRAY_Y_POS),this.cmd("Move",this.barLabels[a],this.barPositionsX[i],LOWER_ARRAY_LABEL_Y_POS),this.cmd("Step"),this.labelsSwap[i]=this.barLabels[a],this.objectsSwap[i]=this.barObjects[a],i++,a++):(this.arraySwap[i]=this.arrayData[o],this.cmd("Move",this.barLabels[o],this.barPositionsX[i],LOWER_ARRAY_LABEL_Y_POS),this.cmd("Move",this.barObjects[o],this.barPositionsX[i],LOWER_ARRAY_Y_POS),this.cmd("Step"),this.labelsSwap[i]=this.barLabels[o],this.objectsSwap[i]=this.barObjects[o],i++,o++);for(i=t;s>=i;i++)this.barObjects[i]=this.objectsSwap[i],this.barLabels[i]=this.labelsSwap[i],this.arrayData[i]=this.arraySwap[i],this.cmd("Move",this.barObjects[i],this.barPositionsX[i],this.array_y_pos),this.cmd("Move",this.barLabels[i],this.barPositionsX[i],this.array_label_y_pos);this.cmd("Step")}else this.cmd("Step")},ComparisonSort.prototype.shellSortCallback=function(t){this.animationManager.clearHistory(),this.commands=new Array;var s;for(s=Math.floor(this.array_size/2);s>=1;s=Math.floor(s/2))for(var r=0;s>r;r+=1){for(var i=0;i<this.array_size;i++)(i-r)%s==0?this.obscureObject[i]&&(this.obscureObject[i]=!1,this.cmd("SetAlpha",this.barObjects[i],1),this.cmd("SetAlpha",this.barLabels[i],1)):this.obscureObject[i]||(this.obscureObject[i]=!0,this.cmd("SetAlpha",this.barObjects[i],.08),this.cmd("SetAlpha",this.barLabels[i],.08));this.cmd("Step"),this.insertionSortSkip(s,r)}this.animationManager.StartNewAnimation(this.commands)},ComparisonSort.prototype.insertionSortSkip=function(t,s){for(var r=t+s;r<this.array_size;r+=t)for(var i=r;i>t-1;){if(this.cmd("SetForegroundColor",this.barObjects[i],HIGHLIGHT_BAR_COLOR),this.cmd("SetForegroundColor",this.barObjects[i-t],HIGHLIGHT_BAR_COLOR),this.cmd("SetBackgroundColor",this.barObjects[i],HIGHLIGHT_BAR_BACKGROUND_COLOR),this.cmd("SetBackgroundColor",this.barObjects[i-t],HIGHLIGHT_BAR_BACKGROUND_COLOR),this.cmd("Step"),this.arrayData[i-t]<=this.arrayData[i]){this.cmd("SetForegroundColor",this.barObjects[i],BAR_FOREGROUND_COLOR),this.cmd("SetForegroundColor",this.barObjects[i-t],BAR_FOREGROUND_COLOR),this.cmd("SetBackgroundColor",this.barObjects[i],BAR_BACKGROUND_COLOR),this.cmd("SetBackgroundColor",this.barObjects[i-t],BAR_BACKGROUND_COLOR);break}this.swap(i,i-t),this.cmd("SetForegroundColor",this.barObjects[i],BAR_FOREGROUND_COLOR),this.cmd("SetForegroundColor",this.barObjects[i-t],BAR_FOREGROUND_COLOR),this.cmd("SetBackgroundColor",this.barObjects[i],BAR_BACKGROUND_COLOR),this.cmd("SetBackgroundColor",this.barObjects[i-t],BAR_BACKGROUND_COLOR),i-=t}},ComparisonSort.prototype.disableUI=function(t){this.resetButton.disabled=!0,this.insertSortButton.disabled=!0,this.selectSortButton.disabled=!0,this.bubbleSortButton.disabled=!0,this.quickSortButton.disabled=!0,this.mergeSortButton.disabled=!0,this.shellSortButton.disabled=!0},ComparisonSort.prototype.enableUI=function(t){this.resetButton.disabled=!1,this.insertSortButton.disabled=!1,this.selectSortButton.disabled=!1,this.bubbleSortButton.disabled=!1,this.quickSortButton.disabled=!1,this.mergeSortButton.disabled=!1,this.shellSortButton.disabled=!1};var currentAlg;