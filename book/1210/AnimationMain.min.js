// Copyright 2011 David Galles, University of San Francisco. All rights reserved.
//
// Redistribution and use in source and binary forms, with or without modification, are
// permitted provided that the following conditions are met:
//
// 1. Redistributions of source code must retain the above copyright notice, this list of
// conditions and the following disclaimer.
//
// 2. Redistributions in binary form must reproduce the above copyright notice, this list
// of conditions and the following disclaimer in the documentation and/or other materials
// provided with the distribution.
//
// THIS SOFTWARE IS PROVIDED BY <COPYRIGHT HOLDER> ``AS IS'' AND ANY EXPRESS OR IMPLIED
// WARRANTIES, INCLUDING, BUT NOT LIMITED TO, THE IMPLIED WARRANTIES OF MERCHANTABILITY AND
// FITNESS FOR A PARTICULAR PURPOSE ARE DISCLAIMED. IN NO EVENT SHALL <COPYRIGHT HOLDER> OR
// CONTRIBUTORS BE LIABLE FOR ANY DIRECT, INDIRECT, INCIDENTAL, SPECIAL, EXEMPLARY, OR
// CONSEQUENTIAL DAMAGES (INCLUDING, BUT NOT LIMITED TO, PROCUREMENT OF SUBSTITUTE GOODS OR
// SERVICES; LOSS OF USE, DATA, OR PROFITS; OR BUSINESS INTERRUPTION) HOWEVER CAUSED AND ON
// ANY THEORY OF LIABILITY, WHETHER IN CONTRACT, STRICT LIABILITY, OR TORT (INCLUDING
// NEGLIGENCE OR OTHERWISE) ARISING IN ANY WAY OUT OF THE USE OF THIS SOFTWARE, EVEN IF
// ADVISED OF THE POSSIBILITY OF SUCH DAMAGE.
//
// The views and conclusions contained in the software and documentation are those of the
// authors and should not be interpreted as representing official policies, either expressed
// or implied, of the University of San Francisco

function getCookie(e){var t,n,r;var i=document.cookie.split(";");for(t=0;t<i.length;t++){n=i[t].substr(0,i[t].indexOf("="));r=i[t].substr(i[t].indexOf("=")+1);n=n.replace(/^\s+|\s+$/g,"");if(n==e){return unescape(r)}}}function setCookie(e,t,n){var r=new Date;r.setDate(r.getDate()+n);var i=escape(t)+(n==null?"":"; expires="+r.toUTCString());document.cookie=e+"="+t}function returnSubmit(e,t,n,r){if(n!=undefined){e.size=n}return function(i){var s=0;if(window.event){s=i.keyCode}else if(i.which){s=i.which}if(s==13){t()}else if(s==59){return false}else if(n!=undefined&&e.value.length>=n||r&&(s<48||s>57)){if(!controlKey(s))return false}}}function animWaiting(){stepForwardButton.disabled=false;if(skipBackButton.disabled==false){stepBackButton.disabled=false}}function animStarted(){skipForwardButton.disabled=false;skipBackButton.disabled=false;stepForwardButton.disabled=true;stepBackButton.disabled=true}function animEnded(){skipForwardButton.disabled=true;stepForwardButton.disabled=true;if(skipBackButton.disabled==false&&paused){stepBackButton.disabled=false}}function anumUndoUnavailable(){skipBackButton.disabled=true;stepBackButton.disabled=true}function timeout(){timer=setTimeout("timeout()",30);animationManager.update();objectManager.draw()}function doStep(){animationManager.step()}function doSkip(){animationManager.skipForward()}function doSkipBack(){animationManager.skipBack()}function doStepBack(){animationManager.stepBack()}function doPlayPause(){paused=!paused;if(paused){playPauseBackButton.setAttribute("value","\u25B6");if(skipBackButton.disabled==false){stepBackButton.disabled=false}}else{playPauseBackButton.setAttribute("value","\u275A\u275A")}animationManager.SetPaused(paused)}function addControl(e,t,n){var r=document.createElement("input");r.setAttribute("type",e);r.setAttribute("value",t);var i=document.createElement("td");i.appendChild(r);var s=document.getElementById(i);s.appendChild(r);return r}function addControlToAnimationBar(e,t,n){if(n==undefined){n="input"}var r=document.createElement(n);r.setAttribute("type",e);r.setAttribute("value",t);if(e=="Button"){r.setAttribute("class","btn-blue");r.setAttribute("style","width:44px")}var i=document.createElement("td");i.appendChild(r);var s=document.getElementById("GeneralAnimationControls");s.appendChild(i);return r}function initCanvas(){canvas=document.getElementById("canvas");objectManager=new ObjectManager;animationManager=new AnimationManager(objectManager);skipBackButton=addControlToAnimationBar("Button","\u275A\u25C0");skipBackButton.onclick=animationManager.skipBack.bind(animationManager);stepBackButton=addControlToAnimationBar("Button","\u25C0\u25C0");stepBackButton.onclick=animationManager.stepBack.bind(animationManager);playPauseBackButton=addControlToAnimationBar("Button","\u275A\u275A");playPauseBackButton.onclick=doPlayPause;stepForwardButton=addControlToAnimationBar("Button","\u25B6\u25B6");stepForwardButton.onclick=animationManager.step.bind(animationManager);skipForwardButton=addControlToAnimationBar("Button","\u25B6\u275A");skipForwardButton.onclick=animationManager.skipForward.bind(animationManager);var e=document.createElement("div");e.setAttribute("display","inline-block");e.setAttribute("float","left");var t=document.createElement("td");var n=document.getElementById("GeneralAnimationControls");var r=document.createElement("table");var i=document.createElement("tr");var s=document.createElement("td");i.appendChild(s);s.appendChild(e);r.appendChild(i);i=document.createElement("tr");s=document.createElement("td");s.align="center";var o=document.createTextNode("Hitrost animacije");i.appendChild(s);s.appendChild(o);r.appendChild(i);t.appendChild(r);n.appendChild(t);var u=getCookie("VisualizationSpeed");if(u==null||u==""){u=ANIMATION_SPEED_DEFAULT}else{u=parseInt(u)}$(e).slider({animate:true,value:u,change:function(e,t){setCookie("VisualizationSpeed",String(t.value),30)},slide:function(e,t){animationManager.SetSpeed(t.value)}});animationManager.SetSpeed(u);e.setAttribute("style","width:200px");var a=getCookie("VisualizationWidth");if(a==null||a==""){a=canvas.width}else{a=parseInt(a)}var f=getCookie("VisualizationHeight");if(f==null||f==""){f=canvas.height}else{f=parseInt(f)}canvas.width=a;canvas.height=f;animationManager.addListener("AnimationStarted",this,animStarted);animationManager.addListener("AnimationEnded",this,this.animEnded);animationManager.addListener("AnimationWaiting",this,this.animWaiting);animationManager.addListener("AnimationUndoUnavailable",this,this.anumUndoUnavailable);objectManager.width=canvas.width;objectManager.height=canvas.height;return animationManager}function AnimationManager(e){this.animatedObjects=e;this.animationPaused=false;this.awaitingStep=false;this.currentlyAnimating=false;this.AnimationSteps=[];this.currentAnimation=0;this.previousAnimationSteps=[];this.currFrame=0;this.animationBlockLength=0;this.currentBlock=null;this.undoStack=[];this.doingUndo=false;this.undoAnimationStepIndices=[];this.undoAnimationStepIndicesStack=[];this.animationBlockLength=10;this.lerp=function(e,t,n){return(t-e)*n+e};this.SetPaused=function(e){this.animationPaused=e;if(!this.animationPaused){this.step()}};this.SetSpeed=function(e){this.animationBlockLength=Math.floor((100-e)/2)};this.parseBool=function(e){var t=e.toUpperCase();var n=!(t=="False"||t=="f"||t==" 0"||t=="0"||t=="");return n};this.parseColor=function(e){if(e.charAt(0)=="#"){return e}else if(e.substring(0,2)=="0x"){return"#"+e.substring(2)}};this.changeSize=function(){var e=parseInt(widthEntry.value);var t=parseInt(heightEntry.value);if(e>100){canvas.width=e;this.animatedObjects.width=e;setCookie("VisualizationWidth",String(e),30)}if(t>100){canvas.height=t;this.animatedObjects.height=t;setCookie("VisualizationHeight",String(t),30)}e.value=canvas.width;heightEntry.value=canvas.height;this.animatedObjects.draw();this.fireEvent("CanvasSizeChanged",{width:canvas.width,height:canvas.height})};this.startNextBlock=function(){this.awaitingStep=false;this.currentBlock=[];var e=[];if(this.currentAnimation==this.AnimationSteps.length){this.currentlyAnimating=false;this.awaitingStep=false;this.fireEvent("AnimationEnded","NoData");clearTimeout(timer);this.animatedObjects.update();this.animatedObjects.draw();return}this.undoAnimationStepIndices.push(this.currentAnimation);var t=false;var n=false;while(this.currentAnimation<this.AnimationSteps.length&&!t){var r=this.AnimationSteps[this.currentAnimation].split("<;>");if(r[0].toUpperCase()=="CREATECIRCLE"){this.animatedObjects.addCircleObject(parseInt(r[1]),r[2]);if(r.length>4){this.animatedObjects.setNodePosition(parseInt(r[1]),parseInt(r[3]),parseInt(r[4]))}e.push(new UndoCreate(parseInt(r[1])))}else if(r[0].toUpperCase()=="CONNECT"){if(r.length>7){this.animatedObjects.connectEdge(parseInt(r[1]),parseInt(r[2]),this.parseColor(r[3]),parseFloat(r[4]),this.parseBool(r[5]),r[6],parseInt(r[7]))}else if(r.length>6){this.animatedObjects.connectEdge(parseInt(r[1]),parseInt(r[2]),this.parseColor(r[3]),parseFloat(r[4]),this.parseBool(r[5]),r[6],0)}else if(r.length>5){this.animatedObjects.connectEdge(parseInt(r[1]),parseInt(r[2]),this.parseColor(r[3]),parseFloat(r[4]),this.parseBool(r[5]),"",0)}else if(r.length>4){this.animatedObjects.connectEdge(parseInt(r[1]),parseInt(r[2]),this.parseColor(r[3]),parseFloat(r[4]),true,"",0)}else if(r.length>3){this.animatedObjects.connectEdge(parseInt(r[1]),parseInt(r[2]),this.parseColor(r[3]),0,true,"",0)}else{this.animatedObjects.connectEdge(parseInt(r[1]),parseInt(r[2]),"#000000",0,true,"",0)}e.push(new UndoConnect(parseInt(r[1]),parseInt(r[2]),false))}else if(r[0].toUpperCase()=="CREATERECTANGLE"){if(r.length==9){this.animatedObjects.addRectangleObject(parseInt(r[1]),r[2],parseInt(r[3]),parseInt(r[4]),r[7],r[8],"#ffffff","#000000")}else{this.animatedObjects.addRectangleObject(parseInt(r[1]),r[2],parseInt(r[3]),parseInt(r[4]),"center","center","#ffffff","#000000")}if(r.length>6){this.animatedObjects.setNodePosition(parseInt(r[1]),parseInt(r[5]),parseInt(r[6]))}e.push(new UndoCreate(parseInt(r[1])))}else if(r[0].toUpperCase()=="MOVE"){var i=parseInt(r[1]);var s=new SingleAnimation(i,this.animatedObjects.getNodeX(i),this.animatedObjects.getNodeY(i),parseInt(r[2]),parseInt(r[3]));this.currentBlock.push(s);e.push(new UndoMove(s.objectID,s.toX,s.toY,s.fromX,s.fromY));n=true}else if(r[0].toUpperCase()=="STEP"){t=true}else if(r[0].toUpperCase()=="SETFOREGROUNDCOLOR"){var o=parseInt(r[1]);var u=this.animatedObjects.foregroundColor(o);this.animatedObjects.setForegroundColor(o,this.parseColor(r[2]));e.push(new UndoSetForegroundColor(o,u))}else if(r[0].toUpperCase()=="SETBACKGROUNDCOLOR"){o=parseInt(r[1]);u=this.animatedObjects.backgroundColor(o);this.animatedObjects.setBackgroundColor(o,this.parseColor(r[2]));e.push(new UndoSetBackgroundColor(o,u))}else if(r[0].toUpperCase()=="SETHIGHLIGHT"){var a=this.parseBool(r[2]);this.animatedObjects.setHighlight(parseInt(r[1]),a);e.push(new UndoHighlight(parseInt(r[1]),!a))}else if(r[0].toUpperCase()=="DISCONNECT"){var f=this.animatedObjects.disconnect(parseInt(r[1]),parseInt(r[2]));if(f!=null){e.push(f)}}else if(r[0].toUpperCase()=="SETALPHA"){var l=this.animatedObjects.getAlpha(parseInt(r[1]));this.animatedObjects.setAlpha(parseInt(r[1]),parseFloat(r[2]));e.push(new UndoSetAlpha(parseInt(r[1]),l))}else if(r[0].toUpperCase()=="SETTEXT"){if(r.length>3){var c=this.animatedObjects.getText(parseInt(r[1]),parseInt(r[3]));this.animatedObjects.setText(parseInt(r[1]),r[2],parseInt(r[3]));e.push(new UndoSetText(parseInt(r[1]),c,parseInt(r[3])))}else{c=this.animatedObjects.getText(parseInt(r[1]),0);this.animatedObjects.setText(parseInt(r[1]),r[2],0);e.push(new UndoSetText(parseInt(r[1]),c,0))}}else if(r[0].toUpperCase()=="DELETE"){var i=parseInt(r[1]);var h;var p=this.animatedObjects.deleteIncident(i);if(p.length>0){e=e.concat(p)}var d=this.animatedObjects.getObject(i);if(d!=null){e.push(d.createUndoDelete());this.animatedObjects.removeObject(i)}}else if(r[0].toUpperCase()=="CREATEHIGHLIGHTCIRCLE"){if(r.length>5){this.animatedObjects.addHighlightCircleObject(parseInt(r[1]),this.parseColor(r[2]),parseFloat(r[5]))}else{this.animatedObjects.addHighlightCircleObject(parseInt(r[1]),this.parseColor(r[2]),20)}if(r.length>4){this.animatedObjects.setNodePosition(parseInt(r[1]),parseInt(r[3]),parseInt(r[4]))}e.push(new UndoCreate(parseInt(r[1])))}else if(r[0].toUpperCase()=="CREATELABEL"){if(r.length==6){this.animatedObjects.addLabelObject(parseInt(r[1]),r[2],this.parseBool(r[5]))}else{this.animatedObjects.addLabelObject(parseInt(r[1]),r[2],true)}if(r.length>=5){this.animatedObjects.setNodePosition(parseInt(r[1]),parseFloat(r[3]),parseFloat(r[4]))}e.push(new UndoCreate(parseInt(r[1])))}else if(r[0].toUpperCase()=="SETEDGECOLOR"){var v=parseInt(r[1]);var m=parseInt(r[2]);var g=this.parseColor(r[3]);var u=this.animatedObjects.setEdgeColor(v,m,g);e.push(new UndoSetEdgeColor(v,m,u))}else if(r[0].toUpperCase()=="SETEDGEALPHA"){var v=parseInt(r[1]);var m=parseInt(r[2]);var y=parseFloat(r[3]);var b=this.animatedObjects.setEdgeAlpha(v,m,y);e.push(new UndoSetEdgeAlpha(v,m,b))}else if(r[0].toUpperCase()=="SETEDGEHIGHLIGHT"){var a=this.parseBool(r[3]);var v=parseInt(r[1]);var m=parseInt(r[2]);var w=this.animatedObjects.setEdgeHighlight(v,m,a);e.push(new UndoHighlightEdge(v,m,w))}else if(r[0].toUpperCase()=="SETHEIGHT"){o=parseInt(r[1]);var E=this.animatedObjects.getHeight(o);this.animatedObjects.setHeight(o,parseInt(r[2]));e.push(new UndoSetHeight(o,E))}else if(r[0].toUpperCase()=="SETLAYER"){this.animatedObjects.setLayer(parseInt(r[1]),parseInt(r[2]))}else if(r[0].toUpperCase()=="CREATELINKEDLIST"){if(r.length==11){this.animatedObjects.addLinkedListObject(parseInt(r[1]),r[2],parseInt(r[3]),parseInt(r[4]),parseFloat(r[7]),this.parseBool(r[8]),this.parseBool(r[9]),parseInt(r[10]),"#FFFFFF","#000000")}else{this.animatedObjects.addLinkedListObject(parseInt(r[1]),r[2],parseInt(r[3]),parseInt(r[4]),.25,true,false,1,"#FFFFFF","#000000")}if(r.length>6){this.animatedObjects.setNodePosition(parseInt(r[1]),parseInt(r[5]),parseInt(r[6]));e.push(new UndoCreate(parseInt(r[1])))}}else if(r[0].toUpperCase()=="SETNULL"){var S=this.animatedObjects.getNull(parseInt(r[1]));this.animatedObjects.setNull(parseInt(r[1]),this.parseBool(r[2]));e.push(new UndoSetNull(parseInt(r[1]),S))}else if(r[0].toUpperCase()=="SETTEXTCOLOR"){if(r.length>3){u=this.animatedObjects.getTextColor(parseInt(r[1]),parseInt(r[3]));this.animatedObjects.setTextColor(parseInt(r[1]),this.parseColor(r[2]),parseInt(r[3]));e.push(new UndoSetTextColor(parseInt(r[1]),u,parseInt(r[3])))}else{u=this.animatedObjects.getTextColor(parseInt(r[1]),0);this.animatedObjects.setTextColor(parseInt(r[1]),this.parseColor(r[2]),0);e.push(new UndoSetTextColor(parseInt(r[1]),u,0))}}else if(r[0].toUpperCase()=="CREATEBTREENODE"){this.animatedObjects.addBTreeNode(parseInt(r[1]),parseFloat(r[2]),parseFloat(r[3]),parseInt(r[4]),this.parseColor(r[7]),this.parseColor(r[8]));this.animatedObjects.setNodePosition(parseInt(r[1]),parseInt(r[5]),parseInt(r[6]));e.push(new UndoCreate(parseInt(r[1])))}else if(r[0].toUpperCase()=="SETWIDTH"){var o=parseInt(r[1]);this.animatedObjects.setWidth(o,parseInt(r[2]));var x=this.animatedObjects.getWidth(o);e.push(new UndoSetWidth(o,x))}else if(r[0].toUpperCase()=="SETNUMELEMENTS"){var T=this.animatedObjects.getObject(parseInt(r[1]));e.push(new UndoSetNumElements(T,parseInt(r[2])));this.animatedObjects.setNumElements(parseInt(r[1]),parseInt(r[2]))}else if(r[0].toUpperCase()=="SETPOSITION"){var o=parseInt(r[1]);var N=this.animatedObjects.getNodeX(o);var C=this.animatedObjects.getNodeY(o);e.push(new UndoSetPosition(o,N.oldY));this.animatedObjects.setNodePosition(o,parseInt(r[2]),parseInt(r[3]))}else if(r[0].toUpperCase()=="ALIGNRIGHT"){var o=parseInt(r[1]);var N=this.animatedObjects.getNodeX(o);var C=this.animatedObjects.getNodeY(o);e.push(new UndoSetPosition(o,N.oldY));this.animatedObjects.alignRight(o,parseInt(r[2]))}else if(r[0].toUpperCase()=="ALIGNLEFT"){var o=parseInt(r[1]);var N=this.animatedObjects.getNodeX(o);var C=this.animatedObjects.getNodeY(o);e.push(new UndoSetPosition(o,N.oldY));this.animatedObjects.alignLeft(o,parseInt(r[2]))}else if(r[0].toUpperCase()=="ALIGNTOP"){var o=parseInt(r[1]);var N=this.animatedObjects.getNodeX(o);var C=this.animatedObjects.getNodeY(o);e.push(new UndoSetPosition(o,N.oldY));this.animatedObjects.alignTop(o,parseInt(r[2]))}else if(r[0].toUpperCase()=="ALIGNBOTTOM"){var o=parseInt(r[1]);var N=this.animatedObjects.getNodeX(o);var C=this.animatedObjects.getNodeY(o);e.push(new UndoSetPosition(o,N.oldY));this.animatedObjects.alignBottom(o,parseInt(r[2]))}else{}this.currentAnimation=this.currentAnimation+1}this.currFrame=0;if(!n&&this.animationPaused||!n&&this.currentAnimation==this.AnimationSteps.length){this.currFrame=this.animationBlockLength}this.undoStack.push(e)};this.StartNewAnimation=function(e){clearTimeout(timer);if(this.AnimationSteps!=null){this.previousAnimationSteps.push(this.AnimationSteps);this.undoAnimationStepIndicesStack.push(this.undoAnimationStepIndices)}if(e==undefined||e.length==0){this.AnimationSteps=["Step"]}else{this.AnimationSteps=e}this.undoAnimationStepIndices=new Array;this.currentAnimation=0;this.startNextBlock();this.currentlyAnimating=true;this.fireEvent("AnimationStarted","NoData");timer=setTimeout("timeout()",30)};this.stepBack=function(){if(this.awaitingStep&&this.undoStack!=null&&this.undoStack.length!=0){this.fireEvent("AnimationStarted","NoData");clearTimeout(timer);this.awaitingStep=false;this.undoLastBlock();clearTimeout(timer);timer=setTimeout("timeout()",30)}else if(!this.currentlyAnimating&&this.animationPaused&&this.undoAnimationStepIndices!=null){this.fireEvent("AnimationStarted","NoData");this.currentlyAnimating=true;this.undoLastBlock();clearTimeout(timer);timer=setTimeout("timeout()",30)}};this.step=function(){if(this.awaitingStep){this.startNextBlock();this.fireEvent("AnimationStarted","NoData");this.currentlyAnimating=true;clearTimeout(timer);timer=setTimeout("timeout()",30)}};this.clearHistory=function(){this.undoStack=[];this.undoAnimationStepIndices=null;this.previousAnimationSteps=[];this.undoAnimationStepIndicesStack=[];this.AnimationSteps=null;this.fireEvent("AnimationUndoUnavailable","NoData");clearTimeout(timer);this.animatedObjects.update();this.animatedObjects.draw()};this.skipBack=function(){var e=this.undoAnimationStepIndices!=null&&this.undoAnimationStepIndices.length!=0;if(e){var t;for(t=0;this.currentBlock!=null&&t<this.currentBlock.length;t++){var n=this.currentBlock[t].objectID;this.animatedObjects.setNodePosition(n,this.currentBlock[t].toX,this.currentBlock[t].toY)}if(this.doingUndo){this.finishUndoBlock(this.undoStack.pop())}while(e){this.undoLastBlock();for(t=0;t<this.currentBlock.length;t++){n=this.currentBlock[t].objectID;this.animatedObjects.setNodePosition(n,this.currentBlock[t].toX,this.currentBlock[t].toY)}e=this.finishUndoBlock(this.undoStack.pop())}clearTimeout(timer);this.animatedObjects.update();this.animatedObjects.draw();if(this.undoStack==null||this.undoStack.length==0){this.fireEvent("AnimationUndoUnavailable","NoData")}}};this.resetAll=function(){this.clearHistory();this.animatedObjects.clearAllObjects();this.animatedObjects.draw();clearTimeout(timer)};this.skipForward=function(){if(this.currentlyAnimating){this.animatedObjects.runFast=true;while(this.AnimationSteps!=null&&this.currentAnimation<this.AnimationSteps.length){var e;for(e=0;this.currentBlock!=null&&e<this.currentBlock.length;e++){var t=this.currentBlock[e].objectID;this.animatedObjects.setNodePosition(t,this.currentBlock[e].toX,this.currentBlock[e].toY)}if(this.doingUndo){this.finishUndoBlock(this.undoStack.pop())}this.startNextBlock();for(e=0;e<this.currentBlock.length;e++){var t=this.currentBlock[e].objectID;this.animatedObjects.setNodePosition(t,this.currentBlock[e].toX,this.currentBlock[e].toY)}}this.animatedObjects.update();this.currentlyAnimating=false;this.awaitingStep=false;this.doingUndo=false;this.animatedObjects.runFast=false;this.fireEvent("AnimationEnded","NoData");clearTimeout(timer);this.animatedObjects.update();this.animatedObjects.draw()}};this.finishUndoBlock=function(e){for(var t=e.length-1;t>=0;t--){e[t].undoInitialStep(this.animatedObjects)}this.doingUndo=false;if(this.undoAnimationStepIndices.length==0){this.awaitingStep=false;this.currentlyAnimating=false;this.undoAnimationStepIndices=this.undoAnimationStepIndicesStack.pop();this.AnimationSteps=this.previousAnimationSteps.pop();this.fireEvent("AnimationEnded","NoData");this.fireEvent("AnimationUndo","NoData");this.currentBlock=[];if(this.undoStack==null||this.undoStack.length==0){this.currentlyAnimating=false;this.awaitingStep=false;this.fireEvent("AnimationUndoUnavailable","NoData")}clearTimeout(timer);this.animatedObjects.update();this.animatedObjects.draw();return false}return true};this.undoLastBlock=function(){if(this.undoAnimationStepIndices.length==0){return}if(this.undoAnimationStepIndices.length>0){this.doingUndo=true;var e=false;this.currentAnimation=this.undoAnimationStepIndices.pop();this.currentBlock=[];var t=this.undoStack[this.undoStack.length-1];var n;for(n=t.length-1;n>=0;n--){var r=t[n].addUndoAnimation(this.currentBlock);e=e||r}this.currFrame=0;if(!e&&this.animationPaused){this.currFrame=this.animationBlockLength}this.currentlyAnimating=true}};this.setLayer=function(e,t){this.animatedObjects.setLayer(e,t);this.animatedObjects.draw()};this.setAllLayers=function(e){this.animatedObjects.setAllLayers(e);this.animatedObjects.draw()};this.update=function(){if(this.currentlyAnimating){this.currFrame=this.currFrame+1;var e;for(e=0;e<this.currentBlock.length;e++){if(this.currFrame>=this.animationBlockLength){this.animatedObjects.setNodePosition(this.currentBlock[e].objectID,this.currentBlock[e].toX,this.currentBlock[e].toY)}else{var t=this.currentBlock[e].objectID;var n=1/(this.animationBlockLength-this.currFrame);var r=this.animatedObjects.getNodeX(t);var i=this.animatedObjects.getNodeY(t);var s=this.currentBlock[e].toX;var o=this.currentBlock[e].toY;var u=this.lerp(this.animatedObjects.getNodeX(t),this.currentBlock[e].toX,n);var a=this.lerp(this.animatedObjects.getNodeY(t),this.currentBlock[e].toY,n);this.animatedObjects.setNodePosition(t,u,a)}}if(this.currFrame>=this.animationBlockLength){if(this.doingUndo){if(this.finishUndoBlock(this.undoStack.pop())){this.awaitingStep=true;this.fireEvent("AnimationWaiting","NoData")}}else{if(this.animationPaused&&this.currentAnimation<this.AnimationSteps.length){this.awaitingStep=true;this.fireEvent("AnimationWaiting","NoData");this.currentBlock=[]}else{this.startNextBlock()}}}this.animatedObjects.update()}}}function SingleAnimation(e,t,n,r,i){this.objectID=e;this.fromX=t;this.fromY=n;this.toX=r;this.toY=i}var timer;var ANIMATION_SPEED_DEFAULT=75;var objectManager;var animationManager;var canvas;var paused=false;var playPauseBackButton;var skipBackButton;var stepBackButton;var stepForwardButton;var skipForwardButton;var widthEntry;var heightEntry;var sizeButton;AnimationManager.prototype=new EventListener;AnimationManager.prototype.constructor=AnimationManager